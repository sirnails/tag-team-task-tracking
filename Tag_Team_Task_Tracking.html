<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tag-Team Task Tracking</title>
    <link rel="icon" href="./static/favicon.ico" type="image/x-icon">
    <link rel="shortcut icon" href="./static/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="./static/css/styles.css">
    <!-- Using local Font Awesome CSS - DO NOT CHANGE TO ONLINE URL -->
    <link rel="stylesheet" href="./static/css/all.min.css">
    <!-- Using local D3.js library - DO NOT CHANGE TO ONLINE URL -->
    <script src="./static/js/d3/d3.v7.min.js"></script>
</head>
<body>
    <div id="taskEditModal" class="modal">
        <div class="modal-content">
            <button class="close-modal">&times;</button>
            <div class="modal-header">
                <h3>Edit Task</h3>
            </div>
            <input type="text" id="taskNameInput" placeholder="Task name..." />
            <textarea id="taskDetailInput" placeholder="Enter task details..."></textarea>
            <div class="modal-footer">
                <button id="cancelTaskDetails" class="cancel-btn"><i class="fas fa-times"></i> Cancel</button>
                <button id="saveTaskDetails" class="timer-btn"><i class="fas fa-save"></i> Save</button>
            </div>
        </div>
    </div>

    <!-- RPS Game Modal -->
    <div id="rpsGameModal" class="modal">
        <div class="modal-content rps-modal-content">
            <button class="close-modal" id="closeRpsModal">&times;</button>
            <div class="modal-header">
                <h3>Rock Paper Scissors</h3>
            </div>
            <div class="rps-game-area">
                <div class="rps-player" id="rpsPlayer1">
                    <div class="rps-hand-display"><i class="fas fa-hand-rock"></i></div>
                    <div class="rps-player-name">Player 1</div>
                    <div class="rps-choice-display"></div>
                </div>
                <div class="rps-vs">VS</div>
                <div class="rps-player" id="rpsPlayer2">
                    <div class="rps-hand-display"><i class="fas fa-hand-rock"></i></div>
                    <div class="rps-player-name">Player 2</div>
                    <div class="rps-choice-display"></div>
                </div>
            </div>
            <div class="rps-choices">
                <p>Choose your weapon:</p>
                <button class="rps-choice-btn" data-choice="rock"><i class="fas fa-hand-rock"></i> Rock</button>
                <button class="rps-choice-btn" data-choice="paper"><i class="fas fa-hand-paper"></i> Paper</button>
                <button class="rps-choice-btn" data-choice="scissors"><i class="fas fa-hand-scissors"></i> Scissors</button>
            </div>
            <div class="rps-status" id="rpsStatus">Waiting for players...</div>
            <div class="modal-footer">
                <button id="resetRpsGame" class="cancel-btn"><i class="fas fa-redo"></i> Reset</button>
            </div>
        </div>
    </div>

    <header class="main-header">
        <div class="header-content">
            <div class="left-controls">
                <h1><i class="fas fa-tasks"></i> Tag-Team Task Tracking</h1>
                <div class="connection-status">
                    <span id="connectionStatus" class="disconnected"><i class="fas fa-circle"></i> Disconnected</span>
                </div>
            </div>
            <div class="center-controls">
                <div class="nav-tabs">
                    <button id="kanbanLink" class="nav-tab active"><i class="fas fa-columns"></i> Kanban Board</button>
                    <button id="workflowLink" class="nav-tab"><i class="fas fa-project-diagram"></i> Workflow</button>
                    <!-- Badge System Button - Styled to match other navigation items -->
                    <button id="badgeSystemBtn" class="nav-tab" title="Badge Collection System"><i class="fas fa-medal"></i> Badges</button>
                    <!-- RPS Game Button -->
                    <button id="rpsGameBtn" class="nav-tab" title="Rock Paper Scissors"><i class="fas fa-hand-rock"></i> RPS</button>
                </div>
            </div>
            <div class="right-controls">
                <div class="room-switcher">
                    <select id="roomSelect" class="room-select">
                        <option value="default">Default Room</option>
                    </select>
                    <button id="newRoomBtn" class="room-btn"><i class="fas fa-plus"></i></button>
                    <button id="deleteRoomBtn" class="room-btn delete-room-btn"><i class="fas fa-trash"></i></button>
                </div>
                <button id="themeToggle" class="theme-toggle">
                    <i class="fas fa-sun"></i>
                </button>
            </div>
        </div>
    </header>

    <div class="app-container">
        <!-- Kanban Content - Shown by default -->
        <div id="kanbanContent">
            <div class="top-section">
                <div class="input-section">
                    <div class="input-title"><i class="fas fa-list"></i> Task Input</div>
                    <textarea id="taskInput" placeholder="Enter your tasks here, one per line..."></textarea>
                    <div class="button-group">
                        <button id="loadTasks"><i class="fas fa-plus-circle"></i> Load Tasks</button>
                        <button id="clearStorage" class="danger"><i class="fas fa-trash-alt"></i> Clear All</button>
                    </div>
                    
                    <!-- Trash column positioned inside input section -->
                    <div class="trash-column column" id="trashColumn">
                        <h2><i class="fas fa-trash-alt"></i> Delete</h2>
                        <div id="trashTasks" class="tasks">
                        </div>
                    </div>
                </div>

                <div class="pomodoro-section">
                    <div class="current-task" id="currentTaskDisplay"><i class="fas fa-clock"></i> No task selected</div>
                    <div class="progress-container">
                        <div class="progress-bar" id="progressBar" style="width: 0%;"></div>
                    </div>
                    <div class="pomodoro-timer" id="timer">25:00</div>
                    <div class="pomodoro-controls">
                        <button id="pomodoroToggle" class="timer-btn"><i class="fas fa-play"></i> Start</button>
                    </div>
                </div>
            </div>

            <main class="main-content">
                <div class="kanban-board">
                    <div class="column" id="todoColumn">
                        <h2><i class="fas fa-clipboard-list"></i> Todo</h2>
                        <div id="todoTasks" class="tasks">
                            <div class="empty-state">Add tasks to get started</div>
                        </div>
                    </div>
                    
                    <div class="column" id="inProgressColumn">
                        <h2><i class="fas fa-spinner"></i> In Progress</h2>
                        <div id="inProgressTasks" class="tasks">
                            <div class="empty-state">Tasks being worked on</div>
                        </div>
                    </div>
                    
                    <div class="column" id="doneColumn">
                        <h2><i class="fas fa-check-circle"></i> Done</h2>
                        <div id="doneTasks" class="tasks">
                            <div class="empty-state">Completed tasks</div>
                        </div>
                    </div>
                </div>
            </main>
        </div>

        <!-- Workflow Content - Hidden by default -->
        <div id="workflowContent" style="display: none;">
            <div class="workflow-container" id="workflowContainer">
                <!-- Work Items List View -->
                <div id="workItemsContainer" class="workflow-section">
                    <div class="workflow-header">
                        <h2><i class="fas fa-tasks"></i> Work Items</h2>
                        <div class="workflow-actions">
                            <button id="addWorkItemBtn" class="primary-btn"><i class="fas fa-plus"></i> Add Work Item</button>
                            <button id="manageWorkflowBtn" class="secondary-btn"><i class="fas fa-cog"></i> Configure Workflow</button>
                        </div>
                    </div>
                    <div id="workItemsList" class="work-items-list">
                        <!-- Work items will be populated here -->
                        <div class="empty-state">No work items yet. Click "Add Work Item" to create one.</div>
                    </div>
                </div>

                <!-- Work Item Detail View (hidden by default) -->
                <div id="workItemDetail" class="workflow-section" style="display: none;">
                    <!-- Work item detail will be populated here -->
                </div>

                <!-- Workflow Configuration View (hidden by default) -->
                <div id="configContainer" class="workflow-section" style="display: none;">
                    <!-- Configuration content will be populated here -->
                </div>
            </div>
        </div>
        
        <!-- Badge System Content - Hidden by default -->
        <div id="badgeContent" style="display: none;">
            <div class="badge-container">
                <div class="badge-section">
                    <div class="badge-header">
                        <h2><i class="fas fa-medal"></i> Badge Collection System</h2>
                    </div>
                    <div class="badge-content">
                        <h3>Welcome to the Badge System</h3>
                        <p>This system allows team members to recognize each other's skills and achievements.</p>
                        <div class="badge-grid">
                            <div class="badge-card">
                                <div class="badge-icon"><i class="fas fa-star"></i></div>
                                <h3>VHDL Design Master</h3>
                                <p>Awarded for excellence in VHDL design practices</p>
                            </div>
                            <div class="badge-card">
                                <div class="badge-icon"><i class="fas fa-code"></i></div>
                                <h3>RTL Wizard</h3>
                                <p>Demonstrates exceptional RTL coding skills</p>
                            </div>
                            <div class="badge-card">
                                <div class="badge-icon"><i class="fas fa-bug"></i></div>
                                <h3>Bug Hunter</h3>
                                <p>Finds and fixes elusive bugs that others miss</p>
                            </div>
                        </div>
                    </div>
                    <div class="badge-content">
                        <h3>Coming Soon!</h3>
                        <p>More badge system features are under development.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { connectWebSocket } from './static/js/websocket/websocket.js';
        import { initializeBoard, updateBoard } from './static/js/kanban/kanban.js';
        import { updateTimerState } from './static/js/pomodoro/pomodoro.js';
        import { initializeWorkflow } from './static/js/workflow/workflow.js';
        // Import RPS game functions
        import { initializeRpsGame } from './static/js/rps-game/rps-game.js';

        document.addEventListener('DOMContentLoaded', function() {
            console.log("HTML: DOMContentLoaded event fired."); // Added log

            try { // Add try...catch for broader error checking
                connectWebSocket();
                console.log("HTML: connectWebSocket called."); // Added log

                // Initialize workflow with empty data (the module will create default states)
                initializeWorkflow({});
                console.log("HTML: initializeWorkflow called."); // Added log

                // Initialize RPS Game
                initializeRpsGame();
                console.log("HTML: initializeRpsGame called."); // Added log

                // Add view toggle functionality for all tabs
                const kanbanLink = document.getElementById('kanbanLink');
                const workflowLink = document.getElementById('workflowLink');
                const badgeSystemBtn = document.getElementById('badgeSystemBtn');
                
                // Kanban View Toggle
                kanbanLink.addEventListener('click', function() {
                    document.getElementById('kanbanContent').style.display = 'block';
                    document.getElementById('workflowContent').style.display = 'none';
                    document.getElementById('badgeContent').style.display = 'none';
                    
                    // Update active tab
                    document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
                    kanbanLink.classList.add('active');
                });
                
                // Workflow View Toggle
                workflowLink.addEventListener('click', function() {
                    document.getElementById('kanbanContent').style.display = 'none';
                    document.getElementById('workflowContent').style.display = 'block';
                    document.getElementById('badgeContent').style.display = 'none';
                    
                    // Update active tab
                    document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
                    workflowLink.classList.add('active');
                });
                
                // Badge System Toggle
                badgeSystemBtn.addEventListener('click', function() {
                    document.getElementById('kanbanContent').style.display = 'none';
                    document.getElementById('workflowContent').style.display = 'none';
                    document.getElementById('badgeContent').style.display = 'block';
                    
                    // Update active tab
                    document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
                    badgeSystemBtn.classList.add('active');
                });
                
                console.log("HTML: Navigation tabs initialized."); // Added log

                // Theme toggle functionality
                const themeToggle = document.getElementById('themeToggle');
                const html = document.documentElement;
                const icon = themeToggle.querySelector('i');
                console.log("HTML: Theme toggle elements obtained."); // Added log

                function toggleTheme() {
                    if (html.getAttribute('data-theme') === 'light') {
                        html.setAttribute('data-theme', 'dark');
                        icon.className = 'fas fa-sun';
                        localStorage.setItem('theme', 'dark');
                    } else {
                        html.setAttribute('data-theme', 'light');
                        icon.className = 'fas fa-moon';
                        localStorage.setItem('theme', 'light');
                    }
                }

                // Initialize theme
                const savedTheme = localStorage.getItem('theme') || 'dark';
                html.setAttribute('data-theme', savedTheme);
                icon.className = savedTheme === 'light' ? 'fas fa-moon' : 'fas fa-sun';
                console.log("HTML: Theme initialized."); // Added log

                themeToggle.addEventListener('click', toggleTheme);
                console.log("HTML: Theme toggle listener added."); // Added log

            } catch (error) {
                console.error("HTML: Error during DOMContentLoaded execution:", error); // Added log
            }
        });
    </script>
</body>
</html>